import{a as xt}from"./chunk-5DYXP5XF.js";import{$ as v,F as k,G as H,H as o,Ia as J,Ja as W,Ka as X,La as Y,M as R,Ma as Z,Oa as tt,P as m,Pa as et,Qa as nt,Ra as it,S as a,Sa as ot,V as c,W as p,Wa as rt,X as C,Xa as at,Y as j,Z as A,_ as M,a as P,aa as r,b as O,c as V,e as q,ea as D,f as u,fa as d,ga as w,ha as E,hb as ct,j as b,jb as st,k as L,la as T,lb as pt,m as z,ma as F,na as B,o as N,q as S,rb as lt,sb as dt,t as I,ta as G,tb as mt,ua as U,ub as _t,v as x,va as Q,vb as gt,w as h,wa as K,wb as ft,xb as ut}from"./chunk-PSNKVQBX.js";function Ct(e,l){if(e&1){let t=M();c(0,"button",8),v("click",function(){x(t);let n=r();return h(n.clear())}),c(1,"mat-icon"),d(2,"close"),p()()}}function vt(e,l){e&1&&(c(0,"div",13),C(1,"mat-progress-spinner",14),c(2,"span"),d(3,"Loading..."),p()())}function bt(e,l){if(e&1&&(c(0,"div",15),d(1),p()),e&2){let t=r(2);o(),w(t.error)}}function Mt(e,l){if(e&1&&(c(0,"div",16),d(1),T(2,"async"),p()),e&2){let t,i=r(2);o(),E(" ",((t=F(2,1,i.filtered$))==null?null:t.length)||0," results ")}}function yt(e,l){if(e&1&&(c(0,"div",9),m(1,vt,4,0,"div",10)(2,bt,2,1,"div",11)(3,Mt,3,3,"div",12),p()),e&2){let t=r();o(),a("ngIf",t.loading),o(),a("ngIf",t.error),o(),a("ngIf",!t.loading&&!t.error)}}function Pt(e,l){if(e&1){let t=M();c(0,"button",24),v("click",function(){x(t);let n=r().$implicit,s=r(3);return h(s.startEdit(n))}),d(1," \u270E "),p()}}function Ot(e,l){if(e&1){let t=M();c(0,"div")(1,"form",25),v("ngSubmit",function(){x(t);let n=r().$implicit,s=r(3);return h(s.saveEdit(n))}),C(2,"input",26)(3,"textarea",27),c(4,"div",28)(5,"button",29),v("click",function(){x(t);let n=r().$implicit,s=r(3);return h(s.saveEdit(n))}),d(6," Save "),p(),c(7,"button",30),v("click",function(){x(t);let n=r().$implicit,s=r(3);return h(s.cancelEdit(n.id))}),d(8," Cancel "),p()()()()}if(e&2){let t,i=r().$implicit,n=r(3);o(),a("formGroup",n.editForms.get(i.id)),o(4),a("disabled",(t=n.editForms.get(i.id))==null?null:t.invalid)}}function St(e,l){if(e&1&&C(0,"img",37),e&2){let t=r(2).$implicit;a("src",t.image_url,H)}}function It(e,l){if(e&1&&(c(0,"div",40)(1,"div",41),d(2),p()()),e&2){let t=l.$implicit;o(2),w(t.body)}}function kt(e,l){if(e&1&&(c(0,"div",38),m(1,It,3,1,"div",39),p()),e&2){let t=r(2).$implicit;o(),a("ngForOf",t.comments)}}function wt(e,l){if(e&1&&(C(0,"h2",31)(1,"p",32),m(2,St,1,1,"img",33),c(3,"div",34)(4,"span",35),d(5),p()(),m(6,kt,2,1,"div",36)),e&2){let t=r().$implicit,i=r(3);a("innerHTML",i.highlight(t.title),k),o(),a("innerHTML",i.highlight(t.body),k),o(),a("ngIf",t.image_url),o(3),E("Likes: ",t.likes||0,""),o(),a("ngIf",t.comments==null?null:t.comments.length)}}function Et(e,l){if(e&1&&(c(0,"div",21),m(1,Pt,2,0,"button",22)(2,Ot,9,2,"div",23)(3,wt,7,5,"ng-template",null,0,B),p()),e&2){let t=l.$implicit,i=D(4),n=r(3);o(),a("ngIf",!n.editing.get(t.id)),o(),a("ngIf",n.editing.get(t.id))("ngIfElse",i)}}function Tt(e,l){e&1&&(c(0,"div",42),d(1," No posts found "),p())}function Ft(e,l){if(e&1&&(j(0),m(1,Et,5,3,"div",19)(2,Tt,2,0,"div",20),A()),e&2){let t=l.ngIf,i=r(2);o(),a("ngForOf",t),o(),a("ngIf",!t.length&&!i.loading&&!i.error)}}function $t(e,l){if(e&1&&(c(0,"div",17),m(1,Ft,3,2,"ng-container",18),T(2,"async"),p()),e&2){let t=r();o(),a("ngIf",F(2,1,t.filtered$))}}var ht=(()=>{class e{query=new tt("");loading=!1;error=null;allPosts=[];filtered$=new q([]);sub=new V;lastQuery="";editing=new Map;editForms=new Map;api=I(xt);fb=I(rt);ngOnInit(){this.loading=!0;let t=this.api.getPosts().pipe(S(()=>{this.error=null}),b(n=>(this.error="Failed to load posts",console.error(n),u([])))).subscribe(n=>{this.allPosts=Array.isArray(n)?n:[],this.filtered$.next([]),this.loading=!1});this.sub.add(t);let i=this.query.valueChanges.pipe(L(250),z(),S(()=>{this.error=null}),N(n=>{let s=(n||"").toString().trim().toLowerCase();if(this.lastQuery=s,!s)return u([]);let f=this.allPosts.filter(g=>(g.title||"").toLowerCase().includes(s)||(g.body||"").toLowerCase().includes(s));return u(f)}),b(n=>(console.error(n),u([])))).subscribe(n=>this.filtered$.next(n));this.sub.add(i)}clear(){this.query.setValue("")}startEdit(t){this.editing.set(t.id,!0);let i=this.fb.group({title:[t.title||"",X.required],body:[t.body||""]});this.editForms.set(t.id,i)}cancelEdit(t){this.editing.set(t,!1),this.editForms.delete(t)}saveEdit(t){let i=this.editForms.get(t.id);if(!i||i.invalid)return;let{title:n,body:s}=i.value,f=this.allPosts.findIndex(_=>_.id===t.id);f>-1&&(this.allPosts[f]=O(P({},this.allPosts[f]),{title:n,body:s}));let g=this.filtered$.getValue().map(_=>_.id===t.id?O(P({},_),{title:n,body:s}):_);this.filtered$.next(g),typeof this.api.updatePost=="function"&&this.api.updatePost(t.id,{title:n,body:s}).pipe(b(_=>(console.error("Update failed",_),this.error="Failed to save changes",u(null)))).subscribe(),this.cancelEdit(t.id)}highlight(t){if(!t)return"";let i=this.lastQuery;if(!i)return this.escapeHtml(t);let s=(g=>{let _=new Set([".","*","+","?","^","$","{","}","(",")","|","[","]","\\","/"]),$="";for(let y of g)$+=_.has(y)?"\\"+y:y;return $})(i),f=new RegExp(s,"ig");return this.escapeHtml(t).replace(f,g=>`<span class="hl">${g}</span>`)}escapeHtml(t){return t.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;").split("'").join("&#39;")}ngOnDestroy(){this.sub.unsubscribe(),this.filtered$.complete(),this.editForms.clear(),this.editing.clear()}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=R({type:e,selectors:[["app-search"]],decls:8,vars:4,consts:[["viewMode",""],[1,"posts-wrapper","search-page"],[1,"search-bar"],[1,"search-icon"],["matInput","","placeholder","Search title or text",3,"formControl"],["mat-icon-button","",3,"click",4,"ngIf"],["class","meta",4,"ngIf"],["class","results",4,"ngIf"],["mat-icon-button","",3,"click"],[1,"meta"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],["class","count",4,"ngIf"],[1,"loading"],["diameter","20","mode","indeterminate"],[1,"error"],[1,"count"],[1,"results"],[4,"ngIf"],["class","posts-card",4,"ngFor","ngForOf"],["class","empty",4,"ngIf"],[1,"posts-card"],["class","edit-icon",3,"click",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"edit-icon",3,"click"],[1,"edit-form",3,"ngSubmit","formGroup"],["formControlName","title","placeholder","Titolo"],["formControlName","body","placeholder","Testo"],[1,"form-actions"],["type","button",1,"submit-btn",3,"click","disabled"],["type","button",1,"cancel-btn",3,"click"],[1,"post-title",3,"innerHTML"],[1,"post-body",3,"innerHTML"],["alt","post image","class","post-image",3,"src",4,"ngIf"],[1,"post-actions"],[1,"likes"],["class","comments",4,"ngIf"],["alt","post image",1,"post-image",3,"src"],[1,"comments"],["class","comment",4,"ngFor","ngForOf"],[1,"comment"],[1,"reply-comment"],[1,"empty"]],template:function(i,n){i&1&&(c(0,"div",1)(1,"div",2)(2,"mat-icon",3),d(3,"search"),p(),C(4,"input",4),m(5,Ct,3,0,"button",5),p(),m(6,yt,4,3,"div",6)(7,$t,3,3,"div",7),p()),i&2&&(o(4),a("formControl",n.query),o(),a("ngIf",n.query.value),o(),a("ngIf",(n.query.value||"").toString().trim().length>0||n.loading||n.error),o(),a("ngIf",(n.query.value||"").toString().trim().length>0))},dependencies:[K,G,U,Q,at,et,W,Y,Z,nt,it,ot,ct,pt,st,lt,mt,dt,gt,_t,ut,ft,J],styles:[`[_nghost-%COMP%]{display:block;min-height:100vh;background:linear-gradient(#e7f8ec,#dff3e6)!important;color:#1f2937!important;box-sizing:border-box}.posts-wrapper[_ngcontent-%COMP%]{background:transparent!important}.posts-wrapper[_ngcontent-%COMP%], input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{padding:32px;background:linear-gradient(#e7f8ec,#dff3e6);font-family:Montserrat,sans-serif}.count[_ngcontent-%COMP%], .search-icon[_ngcontent-%COMP%]{color:#333}.search-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;background:transparent;border:none;padding:0 0 16px}.search-bar[_ngcontent-%COMP%]   input[matInput][_ngcontent-%COMP%]{flex:1;padding:12px;border-radius:6px;border:1px solid #ccc;background:#fff;font-size:16px;font-family:Montserrat,sans-serif}.search-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:transparent}.posts-card[_ngcontent-%COMP%]{background:#fff;border:2px solid #89c997;border-radius:8px;padding:24px;margin-bottom:24px;box-shadow:0 4px 6px #0000001a;position:relative}.edit-icon[_ngcontent-%COMP%]{position:absolute;top:16px;right:16px;background:transparent;border:none;cursor:pointer;color:#2fa66a;font-size:18px}.post-title[_ngcontent-%COMP%]{font-size:22px;color:#2fa66a;margin:0 0 12px}.post-body[_ngcontent-%COMP%]{font-size:16px;color:#333;margin:0 0 16px}.post-image[_ngcontent-%COMP%]{max-width:100%;border-radius:8px;margin-top:12px}.post-actions[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;margin-top:12px}.likes[_ngcontent-%COMP%]{background:#f3f4f6;padding:6px 10px;border-radius:999px;color:#2fa66a;font-weight:700}.edit-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.edit-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .edit-form[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #ccc;border-radius:6px;font-family:Montserrat,sans-serif;font-size:16px;box-sizing:border-box}.form-actions[_ngcontent-%COMP%]{display:flex;gap:8px;margin-top:8px}.submit-btn[_ngcontent-%COMP%]{background:#2fa66a;color:#fff;border:none;padding:10px 16px;border-radius:6px;cursor:pointer;font-weight:700}.cancel-btn[_ngcontent-%COMP%]{background:#ccc;color:#333;border:none;padding:10px 16px;border-radius:6px;cursor:pointer}.empty[_ngcontent-%COMP%]{padding:24px;text-align:center;color:#333;border:1px dashed #89c997;border-radius:8px}@media (max-width: 480px){.posts-wrapper[_ngcontent-%COMP%], input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%], .posts-card[_ngcontent-%COMP%]{padding:16px}}html[_ngcontent-%COMP%], body[_ngcontent-%COMP%], app-root[_ngcontent-%COMP%]{height:100%;min-height:100%;margin:0;background:linear-gradient(#e7f8ec,#dff3e6)!important;color:#1f2937!important}[_ngcontent-%COMP%]:root, .app-container[_ngcontent-%COMP%], .main[_ngcontent-%COMP%], .content[_ngcontent-%COMP%], .mat-sidenav-content[_ngcontent-%COMP%]{background:transparent!important;color:inherit!important}.dark-theme[_ngcontent-%COMP%], .mat-dark[_ngcontent-%COMP%], body.dark[_ngcontent-%COMP%], html.dark[_ngcontent-%COMP%], .theme-dark[_ngcontent-%COMP%]{background:linear-gradient(#e7f8ec,#dff3e6)!important;color:#1f2937!important}.mat-sidenav-container[_ngcontent-%COMP%], .mat-drawer-container[_ngcontent-%COMP%], .mat-card[_ngcontent-%COMP%], .mat-toolbar[_ngcontent-%COMP%], .mat-sidenav[_ngcontent-%COMP%]{background-color:transparent!important}footer[_ngcontent-%COMP%], .app-footer[_ngcontent-%COMP%], .site-footer[_ngcontent-%COMP%]{background:transparent!important;color:inherit!important}body[_ngcontent-%COMP%]{background-image:none!important}
/*# sourceMappingURL=search.component-KFFUGG4D.css.map */`]})}return e})();var ne=[{path:"",component:ht}];export{ne as routes};
//# sourceMappingURL=chunk-FCRBPHHP.js.map
